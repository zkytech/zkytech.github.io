name: Main workflow
on:
    push:
        branches:
            - source
jobs:
    build:
        runs-on: ubuntu-18.04
        steps:
        - uses: actions/checkout@v1
        - name: 同步当前分支文件
          uses: actions/setup-node@v1
          with:
           node-version: 12.x
        - name: 配置环境
          run: |
            mkdir -p ~/.ssh/
            echo "$RSA_TOKEN" > ~/.ssh/id_rsa
            chmod 600 ~/.ssh/id_rsa
            ssh-keyscan github.com >> ~/.ssh/known_hosts
            ssh-keyscan e.coding.net >> ~/.ssh/known_hosts
            ssh-keyscan zkytech.top >> ~/.ssh/known_hosts
            git config --global user.name 'zkytech'
            git config --global user.email 'zhangkunyuan@hotmail.com'
        - name: 配置公钥
          run: |
            npm i -g hexo-cli
            npm i
            hexo generate && hexo deploy
            scp -r public root@zkytech.top:/var/www/blog
        - name: 构建&发布
          env:
            RSA_TOKEN: ${{ secrets.GH_ACTION_DEPLOY_KEY }}